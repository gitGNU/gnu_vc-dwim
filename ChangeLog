2006-10-25  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	* configure.ac: Fix error message not to refer to Automake.

	* vc-chlog.in (func_extract_changed_lines): Fix treatment of
	diffs where either the old or the new file consisted of a single
	line, i.e., the '@@ ... @@' line has less than four numbers.
	This involved some reordering and renaming, in order to keep
	thing consistent.
	* tests/t-vc-chlog: Add a couple of tests.

	* vc-chlog.in (func_extract_changed_lines): GNU diff 2.8.8 may
	strip the prefix space from unchanged empty lines.  Accommodate.
	* tests/t-vc-chlog: Add test for this.

2006-10-25  Jim Meyering  <jim@meyering.net>

	* tests/cl-but-no-diff: Use "set -e" and clean up syntax.

	* VC.pm (GIT DIFF_COMMAND): Change from 'git-diff' to 'cg-diff'.
	The latter detects renames by default.
	* vc-dwim.pl (main): Handle git-diff's rename-indicating syntax.
	* vc-dwim.pl (get_new_changelog_lines): Recognize a header line
	with only one comma, e.g., "@@ -1 +1,4 @@".
	* tests/git-mv: New file.  Test for both of the above changes.
	* tests/Makefile.am (TESTS): Add git-mv.
	* NEWS: Mention this fix.

2006-10-24  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	* tests/t-vc-chlog: Fail gracefully upon setup failure.  Compare
	output of the large test against three possibilities: the "perfect"
	output, that created by Exuberant Ctags, and that created by Emacs
	ctags.  Write all comparisons in the form `diff expected actual'.
	Report of failures fixed by this and the previous patch by
	Jim Meyering.

	* vc-chlog.in (func_extract_changed_lines): Rewrite to also output
	the number of prefix slashes to strip, and the start and ending line
	for each file the patch addresses.
	(func_extract_identifiers): Adjust, and get rid of...
	(func_extract_diff): ...removed.  Buggy and unusable.

2006-10-23  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	* vc-chlog.in (func_help): Update TODO.
	* vc-dwim.pl (get_diffs, get_new_changelog_lines): Add some
	semicolons.
	(exists_editor_backup): Actually test the other suffixes.

2006-10-22  Jim Meyering  <meyering@rho.meyering.net>

	* tests/trap-setup: New file.  Factor trap-related code out of tests.
	* tests/Makefile.am (EXTRA_DIST): Add trap-setup.
	* tests/cl-but-no-diff: Use trap-setup, rather than open-coding it.
	* tests/cl-other-user: Likewise.
	* tests/leading-comment: Likewise.
	* tests/no-star: Likewise.
	* tests/no-vc: Likewise.
	* tests/subdir: Likewise.
	* tests/subdir-cvs: Likewise.
	* tests/symlinked-changelog: Likewise.
	* tests/t-vc-chlog: Likewise.
	* tests/two-line-attr: Likewise.
	* tests/two-vc: Likewise.

2006-10-22  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	* configure.ac: Compute and substitute AWK, CTAGS,
	ctags_strip_type_column.  Prefer Exuberant Ctags, do a feature
	test for the extra column.  Make `vc-chlog' a config file.
	* Makefile.am: Adjust, no need for manual rule any more.
	* vc-chlog.in: Adjust.

	* tests/Makefile.am: Ensure `cd' does not fail.
	* tests/cl-but-no-diff: Likewise.
	* tests/cl-other-user: Likewise.
	* tests/leading-comment: Likewise.
	* tests/no-star: Likewise.
	* tests/no-vc: Likewise.
	* tests/subdir: Likewise.
	* tests/subdir-cvs: Likewise.
	* tests/symlinked-changelog: Likewise.
	* tests/t-vc-chlog: Likewise.
	* tests/two-line-attr: Likewise.
	* tests/two-vc: Likewise.

	* tests/cl-but-no-diff: Quote to allow spaces in `pwd` output.
	* tests/cl-other-user: Likewise.
	* tests/leading-comment: Likewise.
	* tests/no-star: Likewise.
	* tests/no-vc: Likewise.
	* tests/subdir: Likewise.
	* tests/subdir-cvs: Likewise.
	* tests/symlinked-changelog: Likewise.
	* tests/two-line-attr: Likewise.
	* tests/two-vc: Likewise.

	* tests/t-vc-chlog: Adjust to style of other tests.

2006-10-21  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	* vc-chlog.in (func_extract_changed_lines): Factor code a bit.

	* vc-chlog.in (func_extract_changed_lines): Detect diffs that
	contain zero hunks for some file.  Warn, do not output its name.
	* tests/t-vc-chlog: Adjust.

2006-10-20  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (exists_editor_backup): Check for less-common Vim
	backup file names.  Suggestion from Ralf Wildenhues.

2006-10-20  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	* vc-chlog.in: New script.
	* NEWS: Update.
	* Makefile.am: Update.
	* tests/t-vc-chlog: New test.
	* tests/Makefile.am: Update.

2006-10-14  Jim Meyering  <jim@meyering.net>

	* VC.pm: Add comments outlining functions-to-be.

2006-10-11  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (main): Disable git's pager, which would otherwise
	default to pipe to $PAGER, now, for "git diff".

2006-10-06  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (main): Accept a two-line ChangeLog attribution.
	* tests/two-line-attr: New test for the above.
	* tests/Makefile.am (TESTS): Add new test name.

2006-09-28  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (main): Make a single ChangeLog argument optional,
	when it's in the current directory.
	With --diff, don't require a command line argument.  I.e., assume "."

2006-09-27  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (DESCRIPTION): In the default mode, mention that
	the ChangeLog must be locally modified.
	(get_new_changelog_lines): Bail out right away if diff output is empty.
	Give a diagnostics, when "diff" shows no newly added lines,
	and when it produces no output at all.

2006-09-23  Jim Meyering  <jim@meyering.net>

	* configure.ac: Version 0.2.2-devel.
	* NEWS: Update.

	* configure.ac: Version 0.2.1.
	* NEWS: Update the release date.

	* Makefile.am (release): Don't allow reuse of a release tag.

	* Makefile.am (vc-dwim): Get revision from ".", not vc-dwim.pl.
	(release): Don't tag if there are pending changes.

	* Makefile.am (vc-dwim): Factor: s/vc-dwim/$@/.
	(release): New target.

	* tests/require-hg: Discard stderr output.
	* tests/require-git: Likewise.
	* Makefile.am (vc-dwim): Likewise.

	* tests/cl-but-no-diff: Require git.

	* tests/Makefile.am (EXTRA_DIST): Add require-git and require-hg.

	Arrange to skip tests that use hg or git, if they're not available.
	* tests/require-git, tests/require-hg: New files.
	* tests/two-vc: Require git and hg.
	* tests/symlinked-changelog: Likewise.
	* tests/cl-other-user: Require git.
	* tests/leading-comment: Likewise.
	* tests/no-star: Likewise.
	* tests/subdir: Likewise.

	* tests/subdir-cvs: Clarify comment.

	* Makefile.am (gen_vc_name_list): Remove stray closing paren.
	Don't use double quotes.

	* tests/Makefile.am (perllibdir): Use $(am__cd), rather than
	just "cd", since the former may produce unwanted output.
	Suggestion from Ralf Wildenhues.

2006-09-22  Jim Meyering  <jim@meyering.net>

	* VC.pm: Undo last change.  Instead, add this...
	(vc_names): ...new function.
	* Makefile.am (gen_vc_name_list): Use the function, not the variable.

	* configure.ac (AM_INIT_AUTOMAKE): Add 'check-news'.

	* NEWS: Mention these portability fixes.

	* Makefile.am (vc-dwim): Compute hg version string of vc-dwim.pl even
	when doing a non-srcdir build.  Suggestion from Ralf Wildenhues.

	* Makefile.am (vc-dwim): Don't fail if hg doesn't recognize the
	--limit or --template options.  Reported by Ralf Wildenhues.
	(gen_vc_name_list): Adjust so it works also in a non-srcdir build.

	* vc-dwim.pl: Consistently say that this file is covered by the
	GPL (rather than a mix of GPL and LGPL).  Reported by Ralf Wildenhues.

	* VC.pm ($vc_cmd): Declare via "our", so that we can ...
	* Makefile.am (gen_vc_name_list): ...get the list of VC programs
	without relying on ./vc-dwim, a circular dependency.
	(vc-dwim): Use $(srcdir)/vc-dwim.pl, not the GNU-make specific "$<".
	Reported by Ralf Wildenhues.

2006-09-21  Jim Meyering  <jim@meyering.net>

	* configure.ac (VERSION): 0.2.
	* NEWS: Record today's date.

	* Makefile.am (vc-dwim): Don't include parentheses in --version
	output if they would be empty.

	* configure.ac (VERSION): 0.1.5.
	* README: Write it.

	* tests/Makefile.am (XFAIL): Remove.
	* tests/no-vc: New test.  Disabled for now.

	* vc-dwim.pl: Add copyright.
	* Coda.pm: Update comments.

	* vc-dwim.pl (find_relevant_file_name): Don't die for irregular
	ChangeLog lines.  Instead, return (undef, 1).  Adjust caller.
	(main): Allow a blank line between summary line(s) and per-file entries.

	* tests/cl-other-user: New file.
	* tests/Makefile.am (TESTS): Add it.

	* vc-dwim.pl (main): Simplify a regexp.

2006-09-19  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (main): Factor out some chdir/run-cmd/chdir-back
	duplication, into...
	(do_at): ...this new function.  Used for both --diff and --commit.
	Die also if Cwd::getcwd fails -- yes, it can happen.

2006-09-18  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (main): Rewrite not to use Tie::IxHash.

	* vc-dwim.pl (main): Remove the --vc=VC_NAME option.

2006-09-17  Jim Meyering  <jim@meyering.net>

	* configure.ac (VERSION): 0.1.4.
	* vc-dwim.pl (DESCRIPTION): Describe new feature.
	* TODO: Remove this item.

	With this change, commits also work with a symlinked ChangeLog.
	* vc-dwim.pl (main): Don't create the log message file and perform
	the commit here.  Instead, do both...
	(do_commit): ...here, in this new function.

	* tests/symlinked-changelog: Test for the above.

	With this change, diffs work with a symlinked ChangeLog.
	* vc-dwim.pl (main): Handle a ChangeLog that is symlinked to a
	version-controlled ChangeLog file in another directory.

	* tests/symlinked-changelog: Now this test passes.
	* tests/Makefile.am (XFAIL_TESTS): Remove it.

	* VC.pm (GIT): Change string value from 'cg' to 'git'.
	* tests/two-vc: Adjust expected output accordingly.
	* tests/cl-but-no-diff: Likewise.

	* Makefile.am: Include date and hash in --version output.
	(vc-dwim): Declare to be "-dirty" if *any* file in this
	hierarchy has not-checked-in changes.

	* tests/symlinked-changelog: New file.
	* tests/Makefile.am (TESTS): Add symlinked-changelog.
	(XFAIL_TESTS): Expect two failures.

	* vc-dwim.pl (main): Indent the list of offending file-name/VC-name
	pairs in a diagnostic.
	* tests/two-vc (vc-dwim): Update expected output, accordingly.

	* VC.pm: Rename constant: CG -> GIT.
	* vc-dwim.pl (main): Likewise.

2006-09-15  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (main): Fix detection of multiple VCS.
	* tests/two-vc: New file.  Test for the above.

2006-09-14  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (valid_file_name): Fix erroneous regexp.

	* vc-dwim.pl (get_diffs): Simplify a loop.  From Ed Santiago.

	* vc-dwim.pl: Move a bunch of comments into...
	* TODO: ...this new file.

	* configure.ac: Require automake 1.9.6 and autoconf-2.59.

2006-09-13  Jim Meyering  <jim@meyering.net>

	* README-devel: New file.

	* vc-dwim.pl (Doc): Say to report bugs to the author.

	* VC.pm (new): Remove trailing newline.
	Unlike die/warn, croak doesn't need/use it.  From Ed Santiago.

2006-09-12  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (exists_editor_backup): Recognize Vim temporaries, too.

2006-09-09  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl: Update comments.
	(usage): Calling parse_from_filehandle with *DATA doesn't
	work after all.  Revert that part of the 2006-09-05 change.
	(get_diffs): Remove some useless trailing spaces from unidiff output.
	(main): Handle unidiff output that may now include empty lines.

	* configure.ac: Version 0.1.3.

	Work even when run from a subdir with git or hg.
	* VC.pm (full_file_name, diff_outputs_full_file_names): New methods.
	(new): Record depth of "." relative to "top" level directory, when
	using a VC like hg or git.
	* vc-dwim.pl (main): When checking whether each affected file
	is listed in the "diff" output, look up full name, if necessary,
	i.e., for hg or git.
	* tests/subdir: Adapt test, now that this finally works.
	* tests/Makefile.am (XFAIL_TESTS): Remove, now that this test
	no longer fails.

2006-09-08  Jim Meyering  <jim@meyering.net>

	* VC.pm: New file.  Factored out of...
	* vc-dwim.pl: ...here.
	* Makefile.am (dist_perllib_DATA): Add VC.pm.

2006-09-06  Jim Meyering  <jim@meyering.net>

	* configure.ac: Version 0.1.3-pre.
	* configure.ac: Version 0.1.2.

	Performance tweak.  Probably not worthwhile, seeing as how it's
	not based on profiling, but for a command like "./vc-dwim --diff",
	it does avoid loading the module.
	* vc-dwim.pl (main): "use" Tie::IxHash only if we'll need it.

	* vc-dwim.pl: Remove now-unnecessary "use dir ...".

	* tests/Makefile.am (TESTS): Add cl-but-no-diff and subdir-cvs.
	* tests/subdir-cvs: New file.

2006-09-05  Jim Meyering  <jim@meyering.net>

	* vc-dwim.pl (verbose_cmd): Quote meta-characters.

	* vc-dwim.pl (usage): Remove now-duplicated/redundant --help text.
	Instead, generate nearly the same output using Pod::PlainText.
	(usage): Use *DATA directly, suggestion from Ed Santiago.
	Remove now-unused local.

	* Makefile.am (SUBDIRS): Prepend ".", so that we're sure to build
	in this directory, updating vc-dwim if needed, before running tests.

	Better parsing.
	* vc-dwim.pl (change_log_line_extract_file_list): Move this function
	"up", to precede new use...
	(find_relevant_file_name): ...here, rather than requiring a more
	limited syntax.
	* tests/cl-but-no-diff: New file.

	* Makefile.am (gen_vc_name_list): Define.  Used to put list
	of recognized version control systems in perldoc output.

	* configure.ac: Version 0.1.1.
	* vc-dwim.pl: Add --print-vc-list option.  Clean up documentation.

	Don't annotate summary lines, and fix a bug.
	* vc-dwim.pl (find_relevant_file): Return a pair.
	(main): Update caller.  Don't add prefix on a summary line.
	(main): Update $offset also when removing leading blank lines.

	* tests/leading-comment: Fix it.

	* vc-dwim.pl (find_relevant_file): Rename from find_parent_file.

2006-09-04  Jim Meyering  <jim@meyering.net>

	* tests/subdir: New file.  Currently expected to fail.
	* tests/Makefile.am (TESTS): Add subdir.

	* vc-dwim.pl: Use $PROCESS_STATUS in place of equivalent code.

	Autoconfiscate, Automakify, and add tests.
	* vc-dwim.pl: Set @INC.  Use @PERL@.

	* ProcessStatus.pm, Coda.pm: New files.

	* vc-dwim.pl: Rename from vc-dwim.
	* vc-dwim: Rename to vc-dwim.pl.

	* vc-dwim: Put documentation in perldoc format.
	Make $VERSION substitutable.

	* vc-dwim (main): Adjust $offset to reflect removal of two lines.
	Depend on Coda.pm and ProcessStatus.pm being in the directory alongside
	this script.
	(main): Add a colon after $file, in the constructed "*"-line.
	(find_parent_file): If the "*" line looks like "* file_name:", don't
	return the ":" as part of the extracted file name.
	(main): Push log file lines onto @log_msg_lines list only *after*
	they might be modified by the find_parent_file()-using code.
	Fix some ?: regexp modifiers that were written as :?.

2006-09-02  Jim Meyering  <jim@meyering.net>

	* vc-dwim: Rename from cvci.
	* cvci: Rename to vc-dwim cvci.
	(main): Tighten up a regexp.
	Add FIXME comment.

2006-09-01  Jim Meyering  <jim@meyering.net>

	* cvci (verbose_cmd): New function.  For consistent verbose output.
	(get_diffs): Use 4+-arg form of open, to avoid quoting problems.

	Allow the user to specify VC manually, in case s/he is using more
	than one (e.g., CVS + RCS).
	* cvci: Implement this, via new --vc=VC_NAME option.
	(usage): Document --vc=VC_NAME.

	* cvci (main): Use a more accurate regexp for +++/--- diff lines.
	Don't print log-summary or diff output unless everything is ok.
	Don't require the existence of a file if it's marked for deletion.
	On the contrary, require its *non*-existence.
	(vc_name): Return undef, rather than 'unknown'.
	(main): Make the code to handle non-'*'-prefixed lines work again.

	* cvci: Use git-diff, not cg-diff, since I don't like being forced
	to use a pager.

	* cvci: New option: --diff.

	* cvci (main): Use a non-greedy (shy) ".*", in case there are two
	or more ":"s on a "*" line.
	E.g., the new-option line, above.

2006-08-30  Jim Meyering  <jim@meyering.net>

	* cvci (main): Handle a diff reflecting an hg-added file.

2006-08-29  Jim Meyering  <jim@meyering.net>

	* cvci (HG, CG, CVS, SVN): Factor out constant names of the version
	control systems we know about.
	Ensure that each affected file is mentioned in @$diff_lines
	Thus, if a new file is listed in a ChangeLog entry, but not e.g.,
	"hg add"ed, this will catch the error.  Another explanation: a typo,
	in case you manually (mis)typed the file name in the ChangeLog.

	* cvci (change_log_line_extract_file_list): New function.
	(main): Handle multiple, comma-separated file names per "*"-
	ChangeLog line.

2006-08-25  Jim Meyering  <jim@meyering.net>

	* cvci (main): Work once again when the first added line is blank.
	(main): Remove the first line, if it is blank.
	Fix a couple of other minor bugs.
	(main): New function.

2006-08-24  Jim Meyering  <jim@meyering.net>

	Work when the first added ChangeLog line doesn't start with '*'.
	* cvci (get_new_changelog_lines): Allow removed ChangeLog lines.
	(get_new_changelog_lines): Update to handle offsets.
	(get_new_changelog_lines): Push offset only once per @@ marker.

	* cvci (get_new_changelog_lines): Rewrite to use get_diffs().
	(exists_editor_backup): Work also for files not in ".".

	* cvci: Add svn.

2006-08-23  Jim Meyering  <jim@meyering.net>

	* cvci (get_new_changelog_lines): Work better for hg.
	(vc_name): Remove debugging cruft.

	* cvci (vc_name): New function.
	(main): Use it.

2006-08-22  Jim Meyering  <jim@meyering.net>

	* cvci (get_new_changelog_lines): Don't require 2nd "@@"
	to be at the end of line.  With hg diff -p, it's not.

	* cvci: Add hg support, fix cg commit command.
	Really check in yesterday's change.
	Unlink message file only after the commit command.

2006-08-21  Jim Meyering  <jim@meyering.net>

	* cvci: Now, works for cogito/git, too.
	* cvci: Clean up.  Detect unsaved temps of the affected files, too,
	not just of the ChangeLogs.
